# dinner-optimizer

Task log: See Todo list.md

## Build notes
- Currently using poetry for local dependency management
- Format follows [src layout](https://informediq.com/python-src-layout-for-aws-lambdas/)
  - In theory, can be used to package lambdas for deployment, but would clash with SAM. There's maybe a way to make the two play nice

## Deploying

(To be scripted)
1. Generate requirements files from poetry `poetry export -f requirements.txt --output src/<nested folder>/requirements.txt --without-hashes`
1. `sam build`
1. `sam deploy --guided`

## Fetch, tail, and filter Lambda function logs

To simplify troubleshooting, SAM CLI has a command called `sam logs`. `sam logs` lets you fetch logs generated by your deployed Lambda function from the command line. In addition to printing the logs on the terminal, this command has several nifty features to help you quickly find the bug.

`NOTE`: This command works for all AWS Lambda functions; not just the ones you deploy using SAM.

```bash
dinner-optimizer$ sam logs -n HelloWorldFunction --stack-name dinner-optimizer --tail
```

You can find more information and examples about filtering Lambda function logs in the [SAM CLI Documentation](https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/serverless-sam-cli-logging.html).

## Tests

Tests are defined in the `tests` folder in this project. Use PIP to install the test dependencies and run tests.

```bash
dinner-optimizer$ pip install -r tests/requirements.txt --user
# unit test
dinner-optimizer$ python -m pytest tests/unit -v
# integration test, requiring deploying the stack first.
# Create the env variable AWS_SAM_STACK_NAME with the name of the stack we are testing
dinner-optimizer$ AWS_SAM_STACK_NAME=<stack-name> python -m pytest tests/integration -v
```

