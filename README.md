# dinner-optimizer

Task log: See Todo list.md

## Using the tool
- The Dinner Optimizer will start a new thread every week, asking for customizations before it makes a meal plan.
- After enough time has passed, it will roll up all the suggestions and - voila - make you a customized meal plan!
- You may continue to send follow-up tweaks if you're not satisfied with the initial list, and Dinner Optimizer will note them down.
- Type "conjure" at any time to generate a new meal list.

## Build notes
- Currently using poetry for local dependency management
- Format follows [src layout](https://informediq.com/python-src-layout-for-aws-lambdas/)
  - In theory, can be used to package lambdas for deployment, but would clash with SAM. There's maybe a way to make the two play nice

## Deploying

(To be scripted)
1. Generate requirements files from poetry `poetry export -f requirements.txt --output src/<nested folder>/requirements.txt --without-hashes`
1. `sam build --no-cached` - it needs to be non-cached to pick up changes to the shared/ module in other lambdas
1. `sam deploy --guided`

## Fetch, tail, and filter Lambda function logs

To simplify troubleshooting, SAM CLI has a command called `sam logs`. `sam logs` lets you fetch logs generated by your deployed Lambda function from the command line. In addition to printing the logs on the terminal, this command has several nifty features to help you quickly find the bug.

`NOTE`: This command works for all AWS Lambda functions; not just the ones you deploy using SAM.

```bash
dinner-optimizer$ sam logs -n HelloWorldFunction --stack-name dinner-optimizer --tail
```

You can find more information and examples about filtering Lambda function logs in the [SAM CLI Documentation](https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/serverless-sam-cli-logging.html).

## Tests

Each Lambda has its own tests, defined in the "tests" subfolder of each function. To run them, use `poetry run pytest`.


For SAM-level tests, do the following:
```bash
dinner-optimizer$ pip install -r tests/requirements.txt --user
# unit test
dinner-optimizer$ python -m pytest tests/unit -v
# integration test, requiring deploying the stack first.
# Create the env variable AWS_SAM_STACK_NAME with the name of the stack we are testing
dinner-optimizer$ AWS_SAM_STACK_NAME=<stack-name> python -m pytest tests/integration -v
```

